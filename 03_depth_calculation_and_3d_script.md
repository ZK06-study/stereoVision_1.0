# 🌐 깊이 계산 및 3D 재구성 실습 - 과외 수업 스크립트

## 📋 수업 개요
- **수업 시간**: 110분 (휴식 10분 포함)
- **난이도**: 중급 ~ 고급
- **학습 목표**: 시차 맵을 실제 깊이로 변환하고 3D 점군 생성
- **선수 지식**: 스테레오비전 기초, 시차 맵 생성

---

## 🎯 수업 진행 시나리오 (110분)

### **도입부 및 수학적 배경 (15분) - 0:00~0:15**

**선생님:** "지금까지 시차 맵을 만들어봤죠? 이제 이 픽셀 단위의 시차를 실제 미터 단위의 거리로 바꿔보겠습니다!"

#### 📐 핵심 공식 설명
```
Z = (f × b) / d
- Z: 실제 깊이 (미터)
- f: 초점거리 (픽셀)  
- b: 베이스라인 (미터)
- d: 시차 (픽셀)
```

#### 🎯 직관적 이해
**실습:** 손가락으로 삼각측량 시연
- "가까이 있을 때 vs 멀리 있을 때 각도 차이"
- "시차가 클수록 가깝고, 작을수록 멀다"

### **DepthCalculator 클래스 구현 (25분) - 0:15~0:40**

**첫 번째 셀 실행 - DepthCalculator 클래스**

#### 🏗️ 클래스 설계 원리
1. **카메라 내부 매개변수**
   ```python
   self.K = np.array([
       [focal_length, 0, self.cx],
       [0, focal_length, self.cy],
       [0, 0, 1]
   ])
   ```

2. **측정 범위 계산**
   - 최소 거리: 최대 시차일 때
   - 최대 거리: 최소 시차일 때
   - 실용적 한계 고려

#### 💡 학생 이해도 체크
**Q:** "왜 초점거리가 픽셀 단위인가요?"
**A:** "디지털 이미지에서는 픽셀이 기본 단위입니다. 실제 mm를 픽셀로 변환한 값이에요."

**실습:** 다른 카메라 매개변수로 객체 생성
- 초점거리: 400, 600, 800
- 베이스라인: 0.06m, 0.12m, 0.20m

### **시차 맵을 깊이 맵으로 변환 (20분) - 0:40~1:00**

**두 번째 셀 실행 - disparity_to_depth() 함수**

#### 🔄 변환 과정 상세 설명
1. **0으로 나누기 방지**
   ```python
   valid_mask = disparity_map > min_disparity
   ```

2. **실제 깊이 계산**
   ```python
   depth_map[valid_mask] = (focal_length * baseline) / disparity_map[valid_mask]
   ```

3. **후처리**
   - 최대 깊이 제한
   - 무효 영역 처리

#### 📊 결과 분석
- 깊이 맵의 색상 의미
- 유효하지 않은 영역의 처리
- 측정 정확도와 한계

**선생님:** "보라색은 가까운 거리, 노란색은 먼 거리를 의미합니다. 이게 바로 우리가 원하던 실제 거리 정보예요!"

### **3D 점군 생성 (25분) - 1:00~1:25**

**세 번째 셀 실행 - create_3d_points() 함수**

#### 🌐 3D 좌표 변환 수식
```python
# 카메라 좌표계로 변환
points_3d[:, 0] = (valid_x - self.cx) * valid_depth / self.focal_length  # X
points_3d[:, 1] = (valid_y - self.cy) * valid_depth / self.focal_length  # Y  
points_3d[:, 2] = valid_depth  # Z
```

#### 🎨 색상 정보 처리
1. **텍스처 매핑**: 원본 이미지의 색상 사용
2. **깊이 기반 색상**: viridis 컬러맵 활용
3. **그레이스케일 확장**: RGB로 변환

#### 📈 성능 최적화
- 점의 개수 제한 (메모리 고려)
- 유효 영역만 선택
- 다운샘플링 옵션

### **휴식 시간 (10분) - 1:25~1:35**

---

### **3D 시각화 및 상호작용 (20분) - 1:35~1:55**

**네 번째 셀 실행 - 3D 점군 시각화**

#### 📱 3D 플롯 조작법 가이드
1. **마우스 조작**
   - 좌클릭 드래그: 회전
   - 우클릭 드래그: 확대/축소
   - 휠: 줌 인/아웃

2. **시점 변경**
   ```python
   ax.view_init(elev=30, azim=45)  # 고도, 방위각
   ```

#### 🔍 분석 포인트
- 객체들의 실제 3D 배치
- 깊이의 연속성
- 노이즈와 아웃라이어

**실습:** 다양한 각도에서 점군 관찰
- 위에서 보기 (elev=90)
- 옆에서 보기 (elev=0)
- 사선에서 보기 (elev=30, azim=45)

### **정확도 분석 및 카메라 매개변수 영향 (15분) - 1:55~2:10**

**다섯 번째 셀 실행 - 매개변수 민감도 분석**

#### 📊 정확도에 영향을 미치는 요인
1. **베이스라인의 영향**
   - 넓을수록: 더 정확하지만 가려짐 증가
   - 좁을수록: 덜 정확하지만 안정적

2. **초점거리의 영향**  
   - 길수록: 더 정밀하지만 시야각 감소
   - 짧을수록: 넓은 시야각하지만 정밀도 감소

#### 🧮 오차 전파 분석
```python
# 시차 오차가 깊이 오차에 미치는 영향
depth_error = (f * b * disparity_error) / (disparity^2)
```

**선생님:** "가까운 물체일수록 시차 오차가 깊이에 미치는 영향이 크다는 걸 알 수 있어요!"

### **실제 응용 및 프로젝트 아이디어 (15분) - 2:10~2:25**

#### 🚀 실제 응용 사례
1. **자율주행차**
   - 장애물 탐지 및 거리 측정
   - 차선 인식 및 주차 지원

2. **로봇공학**
   - SLAM (동시 위치추정 및 지도작성)
   - 물체 조작 및 경로 계획

3. **증강현실**
   - 깊이 기반 객체 배치
   - 실시간 3D 재구성

#### 💡 프로젝트 아이디어
1. **거리 측정기**: 특정 객체까지의 거리 실시간 표시
2. **3D 스캐너**: 여러 각도에서 촬영하여 완전한 3D 모델 생성
3. **가상 가구 배치**: AR 앱에서 실제 공간에 가구 시뮬레이션

### **마무리 및 종합 정리 (10분) - 2:25~2:35**

#### 📝 전체 과정 복습
1. **1단계**: 스테레오 이미지 → 시차 맵
2. **2단계**: 시차 맵 → 깊이 맵  
3. **3단계**: 깊이 맵 → 3D 점군
4. **4단계**: 3D 시각화 및 분석

#### 🎯 핵심 포인트 강조
- **수학적 기초**: 삼각측량의 원리
- **실용적 고려**: 정확도 vs 속도 트레이드오프
- **시스템 설계**: 카메라 매개변수의 중요성

---

## 🎯 수업 운영 팁

### **3D 시각화 효과적 활용**
1. **점진적 공개**: 2D → 2.5D → 3D 순서로
2. **인터랙티브 탐색**: 학생이 직접 조작하게 하기
3. **비교 분석**: 다른 매개변수 결과와 나란히 배치

### **수학 공식 설명법**
1. **시각적 도구**: 그림과 도표 활용
2. **실생활 비유**: 사진 촬영, 측량 등
3. **단계별 유도**: 복잡한 식을 간단한 것부터

### **학생 참여 유도**
1. **매개변수 실험**: "베이스라인을 바꾸면?"
2. **문제 해결**: "노이즈를 줄이려면?"  
3. **창의적 응용**: "이 기술로 뭘 만들 수 있을까?"

---

## 📚 심화 학습 및 프로젝트

### **고급 주제**
1. **다중 뷰 스테레오**: 3개 이상 카메라 활용
2. **시간적 일관성**: 비디오에서의 깊이 추정
3. **딥러닝 기반**: CNN을 활용한 스테레오 매칭

### **실무 프로젝트**
1. **실시간 거리 측정 시스템**
2. **3D 모델링 파이프라인 구축**  
3. **AR/VR 응용 프로그램 개발**

### **추천 도구 및 라이브러리**
- **Open3D**: 3D 데이터 처리
- **PCL**: 점군 처리 전문 라이브러리
- **ROS**: 로봇 시스템 통합 